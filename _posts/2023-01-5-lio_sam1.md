---
title: LIO-SAM学习笔记1
tags: slam
---

LIO_SAM框架的一些学习记录和细节

<!--more-->
**开源代码地址：https://github.com/TixiaoShan/LIO-SAM**

## 1、imageProjection部分：
主要的功能为点云去畸变，需要点云中每个点包含有time这个标签。
首先imuQueue将每一个imu原始信息变换到雷达系下，依次入列。
imuRotX，imuRotY，imuRotZ，以及imuTime这几个队列里面存放的是相邻两帧之间的imu角速度积分得到的旋转角度，第一个为0。这里cloudInfo的初始值由OdomMsg提供。本来imu用来进行角度畸变去除，odom进行平移畸变去除。但是由于平移畸变太小，所以没有用。ProjectPointCloud(), 此函数的主要作用为利用去畸变得到的点云做rangeMat的投影。根据点的实际位置算出其相应的行列坐标。cloudExtraction(), 此函数的主要作用为统计有效点的数量，利用之前的rangeMat，只取在其上有效的点。点的总数量为count。另外，该函数还根据不同的ring获得了每一个ring的起始点云索引。最后，publishClouds()函数的作用为发布提取的有效的点云以及cloudInfo。

cloudInfo包含如下信息：

imuRollInit， 

imuPitchInit，

imuYawInit，

imuAvailable，

odomAvailable，

initialGuess，

startRingIndex(vector)，

endRingIndex(vector)，

pointColInd 每一个有效点的列索引（0-1800）,

pointRange 每一个点的range

## 2、imuPreintegration部分

transfusion这个对象主要的作用为可视化轨迹和odom，作用不是很大，subLaserOdometry接受的话题为mapping部分的里程计消息，然后作为一个低频的lidar odom入列。

subImuOdometry接受的话题为预积分后的imu里程计消息，这个消息作为一个高频的消息，首先入列。然后根据当前时刻和上一帧的雷达里程计时刻之间的imu odom消息。根据坐标变换得到两个时刻之间的坐标增量。用该增量乘之前的雷达里程计，发布imu频率的odom，以及path。

IMUPreintegration对象是imu预积分的主要对象。该对象订阅imu的原始消息以及lio_sam/mapping/odometry_incremental。其中odometryHandler主要作用为接受低频的mapping的odom消息，加入imu预积分的因子图中，然后优化imu预积分。注意，由于imu的消息在另一个进程中不断入列，所以在while循环退出后需要继续进行一下imu预积分（当imu频率不是很高的时候。imuIntegratorImu_->resetIntegrationAndSetBias(prevBiasOdom);
imuHandler的作用就是根据每次更新的bias以imu的频率输出。

